{% extends "mini_buildd/base.html" %}
{% load base %}

{% block mbd_page_title %} - search results{% endblock %}
{% block mbd_page_footer %} &raquo; search results{% endblock %}

{% block localscript %}
	{% if authenticated %}
		{% if result %}
			{% for repository, packages in result.items %}
				{% for package, versions in packages.items %}
					{% for version, distributions in versions.items %}
						{% for distribution, properties in distributions.items %}
// {{ repository }} -> {{ package }} -> {{ version }} -> {{ distribution }}
function toggle_confirmation_dialog_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}()
{
	$('#remove_before_confirmation_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').click(
		function()
		{
			$('#remove_confirmation_dialog_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').toggle();
			$('#remove_before_confirmation_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').toggle();
							{% if properties.migrates_to %}
			$('#propagate_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').toggle();
							{% endif %}
		}
	);
	$('#cancel_removal_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').click(
		function()
		{
			$('#remove_confirmation_dialog_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').toggle();
			$('#remove_before_confirmation_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').toggle();
							{% if properties.migrates_to %}
			$('#propagate_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}').toggle();
							{% endif %}
		}
	);
}
						{% endfor %}
					{% endfor %}
				{% endfor %}
			{% endfor %}

$(document).ready(
	function()
	{
			{% for repository, packages in result.items %}
				{% for package, versions in packages.items %}
					{% for version, distributions in versions.items %}
						{% for distribution, properties in distributions.items %}
		// {{ repository }} -> {{ package }} -> {{ version }} -> {{ distribution }}
		toggle_confirmation_dialog_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}();
						{% endfor %}
					{% endfor %}
				{% endfor %}
			{% endfor %}
	}
);
		{% endif %}
	{% endif %}
{% endblock %}


{% block content %}

	<div id="mb_package_search_results">
		<div class="box">
			<h1 class="box-caption">Search results</h1>

			{% if result %}
				{% for repository, packages in result.items %}
					<div class="inner-box">
						<h1 class="inner-box-caption"><a class="inner-box-anchor"
																						 title="goto repositoroy {{ repository }}"
																						 href="/mini_buildd/repositories/{{ repository }}/">Repository: {{ repository }}</a></h1>

						{% for package, versions in packages.items %}

							<div class="inner-inner-box">
								<h1 class="inner-inner-box-caption">{{ package }}</h1>

								<table>
									<tr>
										<th>Version</th>
										<th>Distributions</th>
									</tr>

									{% for version, distributions in versions.items %}

										<tr>
											<td>{{ version }}</td>
											<td>
												{% for distribution, properties in distributions.items %}
													<span class="separator">|</span>
													{{ distribution }}

													{% if authenticated %}
														<a id="remove_before_confirmation_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}" class="remove" title="Remove package from: {{ distribution }}" href="#">remove</a>
														<span id="remove_confirmation_dialog_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}" style="display: none; color: red; font-weight: bold">Are you sure?
															<a class="button" title="Yes, remove package!"	href="/mini_buildd/repositories/?action=remove&amp;package={{ package|urlencode }}&amp;version={{ version|urlencode }}&amp;repository={{ repository|urlencode }}&amp;distribution={{ distribution|urlencode }}&amp;">yes</a>
															<a id="cancel_removal_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}" class="button" title="No, keep package!" href="#">no</a></span>
														{% if properties.migrates_to %}
															<a id="propagate_{{ forloop.parentloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.parentloop.counter0 }}_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}" class="button" title="to: {{ properties.migrates_to }}" href="/mini_buildd/repositories/?action=propagate&amp;package={{ package|urlencode }}&amp;version={{ version|urlencode }}&amp;repository={{ repository|urlencode }}&amp;from_distribution={{ distribution|urlencode }}&amp;to_distribution={{ properties.migrates_to|urlencode }}">propagate</a>
														{% endif %}

													{% else %}
														<a class="button" title="You need superuser rights!" href="/admin/">log in to manage repositories</a>
													{% endif %}
												{% endfor %}
											</td>
										</tr>

									{% endfor %}
								</table>
							</div><!-- end inner-inner-box -->
						{% endfor %}
					</div><!-- end "inner-box" -->
				{% endfor %}
			{% else %}
				<ul>
					<li><span class="alert">No packages found!</span></li>
					<li>Back to <a href="javascript: history.back()">search</a>.</li>
				</ul>
			{% endif %}
		</div><!-- end "box" -->
	</div>

{% endblock %}
