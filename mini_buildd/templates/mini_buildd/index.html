{% extends "mini_buildd/base.html" %}
{% load base %}

{% block title %}mini-buildd{% endblock %}

{% block content %}

	<div id="mb_index_status">
		<div class="box">
			<h1 class="box-caption"><span class="status {{ daemon.tpl.style }}">{{ daemon.tpl.running_text }}: {{ daemon.tpl.model }} </span></h1>

			<p>{{ daemon.tpl.iqs }} changes files pending in incoming.</p>

			<div id="mb_index_repositories">
				<div class="inner-box">
					<h1 class="inner-box-caption">Repositories</h1>
					{% if repositories.count > 0 %}
						<ul>
							{% for r in repositories %}
								<li><a href="/mini_buildd/repositories/{{ r.identity }}">{{ r }}</a></li>
							{% endfor %}
						</ul>

						<hr />
						<form id="mb_repository_search_form" action="/mini_buildd/repositories/" name="repository-search-form" method="get">
							<input type="hidden" name="action" value="search" />
							<table>
								<tr>
									<th>Package</th>
									<th>Repository</th>
									<th />
								</tr>
								<tr>
									<td><input type="text" name="package" size="80" title="Please enter a package name pattern (shell-like glob)." class="package-input" /></td>
									<td><select name="repository" size="1">
											{% for r in repositories.all %}
												<option value="{{ r.identity|urlencode }}">{{ r }}</option>
											{% endfor %}
											<option selected="selected" value="">any</option>
									</select></td>

									<td class="form-submit"><input title="Search for package!" type="submit" value="Search" /></td>
								</tr>
							</table>
						</form>

						<hr />
						<h3>Packager status</h3>
						<h4>{{ daemon.tpl.packages|length }} packaging:</h4>
						<ul>
							{% for k, p in daemon.tpl.packages.items %}
								<li>{{ p }}</li>
							{% endfor %}
						</ul>

						<h4>Last packages:</h4>
						<ul>
							{% for p in daemon.tpl.last_packages %}
								<li>{{ p }}</li>
							{% endfor %}
						</ul>

					{% else %}
						<p>No prepared repositories.</p>
					{% endif %}
				</div>
			</div>

			<div id="mb_index_chroots">
				<div class="inner-box">
					<h1 class="inner-box-caption">Chroots</h1>
					{% if chroots.count > 0 %}
						<ul>
							{% for c in chroots %}
								<li>{{ c }}</li>
							{% endfor %}
						</ul>

						<hr />
						<h3>Builder status: {{ daemon.tpl.builder_status.tpl.builds|length }}/{{ daemon.tpl.builder_status.tpl.max_builds }} active builds (load {{ daemon.tpl.builder_status.tpl.load }})</h3>

						<p>{{ daemon.tpl.bqs }} build requests pending in queue.</p>

						<h4>{{ daemon.tpl.builder_status.tpl.builds|length }} building:</h4>
						<ul>
							{% for k, b in daemon.tpl.builder_status.tpl.builds.items %}
								<li>{{ b }}</li>
							{% endfor %}
						</ul>

						<h4>Last builds:</h4>
						<ul>
							{% for b in daemon.tpl.builder_status.tpl.last_builds %}
								<li>{{ b }}</li>
							{% endfor %}
						</ul>

					{% else %}
						<p>No prepared chroots.</p>
					{% endif %}
				</div>
			</div>

			<div id="mb_index_remotes">
				<div class="inner-box">
					<h1 class="inner-box-caption">Remotes</h1>
					{% if remotes.count > 0 %}
						<ul>
							{% for r in remotes %}
								<li>{{ r }}</li>
							{% endfor %}
						</ul>

						<hr />
						<h3>Remotes status: {{ daemon.tpl.remotes|length }} active</h3>
						<ul>
							{% for r in daemom.tpl.remotes %}
								<li>{{ r }}</li>
							{% endfor %}
						</ul>


					{% else %}
						<p>No prepared remotes.</p>
					{% endif %}
				</div>
			</div>

		</div>
	</div>

{% endblock %}
